
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì œì—­ í’ê²½ì±„ 2BL 7% ì„ ë‚©í• ì¸ ì”ê¸ˆ ëª¨ì˜ê³„ì‚°ê¸°</title>
    /* ìƒë‹¨ ì…ë ¥ ì˜ì—­ ë ˆì´ì•„ì›ƒ ì¡°ì • */
.base-input-area { 
    padding: 12px; 
    background: #1a2a40; 
    color: white; 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
}

/* ì…ë ¥ì°½ ë„ˆë¹„ë¥¼ 48%ë¡œ ì¡°ì • (ì–µ ë‹¨ìœ„ 123,456,789ì— ìµœì í™”) */
.base-input-area input { 
    width: 48%; 
    background: #fff9c4; 
    border: none; 
    border-bottom: 2px solid #4db6ac; 
    color: #333; 
    font-size: 1.2em; 
    font-weight: bold; 
    text-align: right; 
    outline: none; 
    border-radius: 4px; 
    padding-right: 5px; 
}

/* í•„ìˆ˜ ë¬¸êµ¬ ì¤„ë°”ê¿ˆ ë°©ì§€ ë° ë¼ë²¨ ê³µê°„ í™•ë³´ */
.req-label { 
    color: #ff5252; 
    font-size: 0.8em; 
    font-weight: bold; 
    margin-left: 3px;
    white-space: nowrap; /* ì´ê²Œ í•µì‹¬ì…ë‹ˆë‹¤! ì ˆëŒ€ ì•ˆ ë–¨ì–´ì ¸ìš”. */
}

/* ì™¼ìª½ ë¼ë²¨ í…ìŠ¤íŠ¸ í¬ê¸° ì‚´ì§ ì¡°ì ˆ */
.base-input-area label {
    font-size: 0.95em;
    white-space: nowrap;
    flex-shrink: 0; /* ë¼ë²¨ì´ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê²Œ ë³´í˜¸ */
}</head>
<body>

<div class="container" id="main-cont">
    <header><h1>ì§€ì œì—­ í’ê²½ì±„ 2BL 7%í• ì¸ ì”ê¸ˆìë™ê³„ì‚°ê¸°</h1></header>

    <div class="base-input-area">
        <label style="font-size:1em;">ë‹¹ì´ˆ ë¶„ì–‘ì”ê¸ˆì•¡(30%)<span class="req-label">(í•„ìˆ˜)</span></label>
        <input type="text" id="base-total" oninput="updateFormat(this)" placeholder="0">
    </div>

    <table class="passbook-table">
        <thead>
            <tr>
                <th width="30%">ì…ê¸ˆì¼</th>
                <th width="35%">ì…ê¸ˆì›ê¸ˆ</th>
                <th width="15%">ì¼ìˆ˜</th>
                <th width="20%">ì´ìí˜œíƒ</th>
            </tr>
        </thead>
        <tbody id="row-body"></tbody>
    </table>
    
    <button class="btn-add" onclick="addRow()">+ ì¤‘ê°„ ì…ê¸ˆ ë‚´ì—­ ì¶”ê°€</button>

    <div class="final-box">
        <div class="final-row">
            <span>ì¤‘ê°„ ì •ì‚° í›„ ì”ê¸ˆ ì”ì•¡</span>
            <span id="res-bal" style="font-weight:bold;">0</span>
        </div>
        <div class="final-row">
            <label>ğŸ—“ï¸ ìµœì¢… ì™„ë‚© ì˜ˆì •ì¼<span class="req-label">(í•„ìˆ˜)</span></label>
            <input type="date" id="final-date" oninput="calculate()" style="font-size:1em; border:2px solid #fbc02d; padding:2px; background-color: #fff9c4;">
        </div>
        <div class="final-row" style="color:#d32f2f;">
            <span>ìµœì¢… íšŒì°¨ ì´ìí˜œíƒ <span id="f-days-info" class="days-info"></span></span>
            <span>- <span id="f-int">0</span></span>
        </div>
        <div class="final-row" style="border-top:1px dashed #ccc; padding-top:5px; margin-top:5px;">
            <span>ìµœì¢… ì¥ë¶€ìƒ ì”ì•¡</span>
            <span id="total-book-bal" class="minus-val">0</span>
        </div>
        
        <div class="final-main">
            <label id="final-label" style="font-size:0.85em; font-weight:bold; color:#666;">ìµœì¢… ì‹¤ ì…ê¸ˆì•¡ (ë¶„ì–‘ëŒ€ê¸ˆ)</label>
            <strong id="final-pay">0</strong>
        </div>

        <div id="refund-msg" class="refund-notice" style="display:none;">
            ğŸ’° <b>ì²­êµ¬/í™˜ê¸‰ ê°€ëŠ¥ ì´ì: <span id="refund-amt">0</span>ì›</b><br>
            <small style="font-weight:normal;">ì´ìê°€ ì”ê¸ˆì„ ì´ˆê³¼í•˜ì—¬ í™˜ê¸‰ ëŒ€ìƒì…ë‹ˆë‹¤.</small>
        </div>
        
        <div id="warn-msg" style="color:red; font-size:0.85em; font-weight:bold; margin-top:10px; display:none; text-align:center;">
            ğŸš¨ 3/24 ê¸°í•œ ë„ê³¼! ëª¨ë“  ì„ ë‚© í˜œíƒì´ ì†Œë©¸ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <div class="total-benefit-bar">
        ì´ ì„ ë‚©í• ì¸ í˜œíƒ: <span id="total-benefit" style="color:#4db6ac;">0</span>ì›
    </div>
</div>

<script>
    const RATE = 0.07;
    const END_D = new Date('2026-05-04');
    const LIMIT_D = new Date('2026-03-24');

    function updateFormat(el) {
        let val = el.value.replace(/[^0-9]/g, '');
        el.value = val ? Number(val).toLocaleString() : '';
        calculate();
    }

    function addRow() {
        const tbody = document.getElementById('row-body');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="date" class="i-date" oninput="calculate()"></td>
            <td><input type="text" class="i-amt" oninput="updateFormat(this)" placeholder="0"></td>
            <td class="r-days">-</td>
            <td class="r-int txt-red">0</td>
        `;
        tbody.appendChild(tr);
    }

    function calculate() {
        // [ì¶”ê°€] ì ¤ ìœ„ ì”ê¸ˆë¶€í„° ì…ë ¥í•˜ë¼ëŠ” 'ë˜‘ë˜‘í•œ ê°€ì´ë“œ'
        let baseInput = document.getElementById('base-total');
        let baseTotal = parseInt(baseInput.value.replace(/,/g, '')) || 0;
        
        const rows = document.querySelectorAll('#row-body tr');
        const fDateVal = document.getElementById('final-date').value;

        // ì‚¬ìš©ìê°€ ë¬´ì–¸ê°€ ì…ë ¥í•˜ë ¤ê³  í•˜ëŠ”ë° ìƒë‹¨ ì”ê¸ˆì´ 0ì´ë©´ ê²½ê³ 
        if (baseTotal === 0 && (rows.length > 0 || fDateVal)) {
            // ì…ê¸ˆì¼ì´ë‚˜ ê¸ˆì•¡ì´ í•˜ë‚˜ë¼ë„ ì±„ì›Œì ¸ ìˆìœ¼ë©´ ì•Œë¦¼
            let hasAnyInput = false;
            rows.forEach(r => { if(r.querySelector('.i-date').value || r.querySelector('.i-amt').value) hasAnyInput = true; });
            
            if (hasAnyInput || fDateVal) {
                alert("ì ¤ìœ„ ì”ê¸ˆ(30%)ê¸ˆì•¡ë¶€í„° ì…ë ¥í•˜ì„¸ìš”! ğŸ˜Š");
                baseInput.focus();
                return;
            }
        }

        let currentBal = baseTotal;
        const isExpired = fDateVal && new Date(fDateVal) > LIMIT_D;
        
        document.getElementById('main-cont').className = isExpired ? 'container expired' : 'container';
        document.getElementById('warn-msg').style.display = isExpired ? 'block' : 'none';

        let totalIntSum = 0;

        rows.forEach(row => {
            const dVal = row.querySelector('.i-date').value;
            const aVal = parseInt(row.querySelector('.i-amt').value.replace(/,/g, '')) || 0;
            const dayCell = row.querySelector('.r-days');
            const intCell = row.querySelector('.r-int');

            let interest = 0;
            if (dVal && !isExpired && aVal >= 10000000) {
                const pDate = new Date(dVal);
                let days = Math.floor((END_D - pDate) / (1000 * 60 * 60 * 24)) + 1;
                days = Math.max(0, Math.min(100, days));
                dayCell.innerText = days;
                interest = Math.floor((aVal * RATE * days / 365) / 10) * 10;
            } else {
                dayCell.innerText = dVal && isExpired ? "ì†Œë©¸" : "-";
                interest = 0;
            }
            intCell.innerText = interest.toLocaleString();
            currentBal -= (aVal + interest);
            totalIntSum += interest;
        });

        document.getElementById('res-bal').innerText = currentBal.toLocaleString() + "ì›";

        let finalInt = 0;
        let fDays = 0; // [ì¶”ê°€] ìµœì¢… ì¼ìˆ˜ ë³€ìˆ˜
        if (fDateVal) {
            const fDate = new Date(fDateVal);
            fDays = Math.floor((END_D - fDate) / (1000 * 60 * 60 * 24)) + 1;
            fDays = Math.max(0, Math.min(100, fDays));

            if (!isExpired && currentBal > 0) {
                finalInt = Math.floor((currentBal * RATE * fDays / 365) / 10) * 10;
            }
            if (!isExpired) totalIntSum += finalInt;
            // [ì¶”ê°€] ìš°ì¸¡ì— ì¼ìˆ˜ í‘œì‹œ
            document.getElementById('f-days-info').innerText = `(ì¼ìˆ˜: ${fDays}ì¼)`;
        } else {
            document.getElementById('f-days-info').innerText = "";
        }
        
        document.getElementById('f-int').innerText = finalInt.toLocaleString();
        let finalBookBal = currentBal - finalInt; 
        
        const fBookBalEl = document.getElementById('total-book-bal');
        fBookBalEl.innerText = finalBookBal.toLocaleString() + "ì›";
        fBookBalEl.style.color = finalBookBal < 0 ? "#1565c0" : "#333";

        const fPayEl = document.getElementById('final-pay');
        const refundMsg = document.getElementById('refund-msg');
        
        if (finalBookBal < 0 && !isExpired) {
            fPayEl.innerText = "0ì›";
            refundMsg.style.display = 'block';
            document.getElementById('refund-amt').innerText = Math.abs(finalBookBal).toLocaleString();
        } else {
            fPayEl.innerText = Math.max(0, finalBookBal).toLocaleString() + "ì›";
            refundMsg.style.display = 'none';
        }
        
        document.getElementById('total-benefit').innerText = isExpired ? "0" : totalIntSum.toLocaleString();
    }
    window.onload = addRow;
</script>
</body>
</html>
