<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지제역 풍경채 2BL 완납 조건 계산기</title>
    <style>
        :root { --main: #004c32; --gold: #b8860b; --bg: #f8f9fa; --red: #dc2626; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); overflow: hidden; }
        .header { background: var(--main); color: white; padding: 25px 15px; text-align: center; border-bottom: 5px solid var(--gold); }
        .content { padding: 20px; }
        .notice-red { color: var(--red); font-size: 0.85rem; font-weight: bold; line-height: 1.6; margin-bottom: 15px; background: #fff1f0; padding: 10px; border: 1px solid #ffa39e; border-radius: 5px; }
        .card-box { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 15px; margin-bottom: 25px; }
        h2 { font-size: 1rem; color: var(--main); border-left: 4px solid var(--gold); padding-left: 10px; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { background: #f1f3f5; padding: 10px; border: 1px solid #dee2e6; }
        td { border: 1px solid #dee2e6; padding: 0; }
        input { width: 100%; border: none; padding: 12px 10px; box-sizing: border-box; text-align: right; font-size: 1rem; background: #fffdf0; font-weight: bold; }
        input[type="date"] { text-align: center; font-size: 0.95rem; font-weight: normal; }
        .target-input { background: #eef2ff; border: 2px solid #6366f1; border-radius: 8px; margin-bottom: 15px; padding: 10px; }
        .target-input span { font-size: 0.85rem; color: #4f46e5; font-weight: bold; }
        .res-badge { background: #f0fdf4; color: #166534; padding: 10px; border-radius: 8px; text-align: right; margin-top: 10px; font-weight: bold; border: 1px solid #bbf7d0; }
        .total-floating { background: #2d3436; color: white; padding: 20px; text-align: center; border-top: 4px solid var(--gold); }
        .total-floating div { font-size: 2.2rem; font-weight: bold; color: #ffeaa7; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>지제역 반도체밸리 제일풍경채 2BL</h1>
        <p>중도금 이자 지원 및 잔금 완납 조건부 혜택 모의 계산기</p>
    </div>

    <div class="content">
        <div class="notice-red">
            ※ 주의: 잔금 할인은 <b>3/24까지 전액 완납</b> 시에만 적용됩니다. 단 1원이라도 3/25 이후에 납부하면 모든 선납 할인은 소멸됩니다. (허당 주의!)
        </div>

        <div class="target-input">
            <span>나의 총 잔금 합계액 (직접입력)</span>
            <input type="text" id="targetAmt" placeholder="예: 150,000,000" oninput="handleInput(this)" style="background:white; border:1px solid #ccc; margin-top:5px;">
        </div>

        <div class="card-box">
            <h2>중도금 이자 지원 (연 1.5%)</h2>
            <table>
                <thead><tr><th width="15%">회차</th><th width="40%">납부일</th><th width="45%">금액(원)</th></tr></thead>
                <tbody id="midB"></tbody>
            </table>
            <div class="res-badge">중도금 지원 합계: <span id="midT">0</span>원</div>
        </div>

        <div class="card-box">
            <h2>잔금 선납 할인 (연 7.0%)</h2>
            <p style="font-size:0.75rem; color:#666; margin-bottom:5px;">* 최대 100일 한도 / 5월 4일 기준 계산</p>
            <table>
                <thead><tr><th width="15%">회차</th><th width="40%">납부일</th><th width="45%">금액(원)</th></tr></thead>
                <tbody id="balB"></tbody>
            </table>
            <div id="balMsg" style="color:red; font-size:0.8rem; margin-top:10px; display:none; font-weight:bold;">[경고] 완납 미달 또는 3/24 초과 납부로 혜택 대상이 아닙니다.</div>
            <div class="res-badge">잔금 할인 합계: <span id="balT">0</span>원</div>
        </div>
    </div>

    <div class="total-floating">
        <small>총 예상 혜택 합계</small>
        <div id="finalT">0원</div>
    </div>
</div>

<script>
    const M_LIMIT = new Date('2026-02-22');
    const B_CALC_END = new Date('2026-05-04');
    const B_DEADLINE = new Date('2026-03-24');

    function formatComma(v) {
        v = v.replace(/[^0-9]/g, ""); 
        return v.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function uncomma(v) { return v.replace(/,/g, ""); }

    function handleInput(el) {
        el.value = formatComma(el.value);
        calc();
    }

    function create(id, n, cls) {
        const b = document.getElementById(id);
        for(let i=1; i<=n; i++) {
            const r = b.insertRow();
            r.innerHTML = `<td>${i}</td>
                <td><input type="date" class="${cls}-d" oninput="calc()"></td>
                <td><input type="text" class="${cls}-a" placeholder="0" oninput="handleInput(this)"></td>`;
        }
    }
    create('midB', 12, 'm'); create('balB', 16, 'b');

    function calc() {
        let mT = 0, bT = 0, bSumAmt = 0;
        let isDeadlinePass = false;
        const targetBalAmt = parseFloat(uncomma(document.getElementById('targetAmt').value)) || 0;

        // 중도금
        document.querySelectorAll('.m-d').forEach((el, i) => {
            const a = parseFloat(uncomma(document.querySelectorAll('.m-a')[i].value)) || 0;
            if(el.value && a > 0) {
                const d = Math.floor((M_LIMIT - new Date(el.value))/86400000)+1;
                if(d > 0) mT += Math.floor(a * 0.015 / 365) * d;
            }
        });

        // 잔금
        document.querySelectorAll('.b-d').forEach((el, i) => {
            const a = parseFloat(uncomma(document.querySelectorAll('.b-a')[i].value)) || 0;
            if(el.value && a > 0) {
                const pDate = new Date(el.value);
                bSumAmt += a;
                if(pDate > B_DEADLINE) isDeadlinePass = true;
                
                let d = Math.floor((B_CALC_END - pDate)/86400000)+1;
                d = Math.min(100, Math.max(0, d));
                bT += Math.floor(a * 0.07 / 365) * d;
            }
        });

        // 잔금 혜택 조건 검증 (완납 여부 & 데드라인 준수)
        const isQualified = (targetBalAmt > 0 && bSumAmt >= targetBalAmt && !isDeadlinePass && targetBalAmt >= 10000000);
        
        if (bSumAmt > 0) {
            document.getElementById('balMsg').style.display = isQualified ? 'none' : 'block';
        } else {
            document.getElementById('balMsg').style.display = 'none';
        }

        const finalBT = isQualified ? bT : 0;
        document.getElementById('midT').innerText = Math.round(mT).toLocaleString();
        document.getElementById('balT').innerText = Math.round(finalBT).toLocaleString();
        document.getElementById('finalT').innerText = Math.round(mT + finalBT).toLocaleString() + "원";
    }
</script>
</body>
</html>