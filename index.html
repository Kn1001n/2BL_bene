
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì œì—­ í’ê²½ì±„ 2BL 7% ì„ ë‚©í• ì¸ ì”ê¸ˆ ëª¨ì˜ê³„ì‚°ê¸°</title>
    <style>
        :root { --primary: #2e7d32; --bg: #f4f7f4; --card-bg: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 480px; margin: 0 auto; background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; }
        header { background: var(--primary); color: white; padding: 12px; text-align: center; }
        header h1 { margin: 0; font-size: 1.2em; letter-spacing: -1px; }
        .base-input-area { padding: 12px; background: #1a2a40; color: white; display: flex; align-items: center; justify-content: space-between; }
        .base-input-area input { width: 55%; background: transparent; border: none; border-bottom: 2px solid #4db6ac; color: #fff; font-size: 1.2em; font-weight: bold; text-align: right; outline: none; }
        .passbook-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .passbook-table th { background: #eee; padding: 8px 5px; color: #666; border-bottom: 1px solid #ddd; }
        .passbook-table td { padding: 10px 5px; border-bottom: 1px dotted #ddd; text-align: center; }
        .passbook-table input { width: 90%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; text-align: center; }
        .txt-red { color: #d32f2f; font-weight: bold; }
        .btn-add { width: 100%; padding: 12px; background: #fff; border: none; border-bottom: 2px solid #eee; color: var(--primary); font-weight: bold; cursor: pointer; }
        
        .final-box { background: #fffde7; padding: 15px; border-top: 3px double #fbc02d; }
        .final-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.95em; color: #444; }
        .final-main { text-align: center; margin-top: 8px; padding: 12px; background: #fff; border: 2px solid #fbc02d; border-radius: 10px; }
        .final-main strong { font-size: 1.5em; color: #d32f2f; display: block; }
        
        /* ë§ˆì´ë„ˆìŠ¤ ì”ì•¡ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .minus-val { color: #1565c0; font-weight: bold; font-size: 1.1em; }
        .refund-notice { background: #e3f2fd; border-radius: 8px; padding: 12px; margin-top: 10px; border: 1px solid #2196f3; font-size: 0.95em; color: #0d47a1; text-align: center; }
        .total-benefit-bar { background: #1a2a40; color: #fff; padding: 12px; text-align: center; font-weight: bold; font-size: 1em; }
        .expired { background: #ffebee !important; }
    </style>
</head>
<body>

<div class="container" id="main-cont">
    <header><h1>ì§€ì œì—­ í’ê²½ì±„ 2BL 7%í• ì¸ ì”ê¸ˆìë™ê³„ì‚°ê¸°</h1></header>

    <div class="base-input-area">
        <label style="font-size:1em;">ë‹¹ì´ˆ ë¶„ì–‘ì”ê¸ˆì•¡(30%)</label>
        <input type="text" id="base-total" oninput="updateFormat(this)" placeholder="0">
    </div>

    <table class="passbook-table">
        <thead>
            <tr>
                <th width="30%">ì…ê¸ˆì¼</th>
                <th width="35%">ì…ê¸ˆì›ê¸ˆ</th>
                <th width="15%">ì¼ìˆ˜</th>
                <th width="20%">ì´ìí˜œíƒ</th>
            </tr>
        </thead>
        <tbody id="row-body"></tbody>
    </table>
    
    <button class="btn-add" onclick="addRow()">+ ì¤‘ê°„ ì…ê¸ˆ ë‚´ì—­ ì¶”ê°€</button>

    <div class="final-box">
        <div class="final-row">
            <span>ì¤‘ê°„ ì •ì‚° í›„ ì”ê¸ˆ ì”ì•¡</span>
            <span id="res-bal" style="font-weight:bold;">0</span>
        </div>
        <div class="final-row">
            <label>ğŸ—“ï¸ ìµœì¢… ì™„ë‚© ì˜ˆì •ì¼</label>
            <input type="date" id="final-date" oninput="calculate()" style="font-size:1em; border:1px solid #fbc02d; padding:2px;">
        </div>
        <div class="final-row" style="color:#d32f2f;">
            <span>ìµœì¢… íšŒì°¨ ì´ìí˜œíƒ</span>
            <span>- <span id="f-int">0</span></span>
        </div>
        <div class="final-row" style="border-top:1px dashed #ccc; padding-top:5px; margin-top:5px;">
            <span>ìµœì¢… ì¥ë¶€ìƒ ì”ì•¡</span>
            <span id="total-book-bal" class="minus-val">0</span>
        </div>
        
        <div class="final-main">
            <label id="final-label" style="font-size:0.85em; font-weight:bold; color:#666;">ìµœì¢… ì‹¤ ì…ê¸ˆì•¡ (ë¶„ì–‘ëŒ€ê¸ˆ)</label>
            <strong id="final-pay">0</strong>
        </div>

        <div id="refund-msg" class="refund-notice" style="display:none;">
            ğŸ’° <b>ì²­êµ¬/í™˜ê¸‰ ê°€ëŠ¥ ì´ì: <span id="refund-amt">0</span>ì›</b><br>
            <small style="font-weight:normal;">ì´ìê°€ ì”ê¸ˆì„ ì´ˆê³¼í•˜ì—¬ í™˜ê¸‰ ëŒ€ìƒì…ë‹ˆë‹¤.</small>
        </div>
        
        <div id="warn-msg" style="color:red; font-size:0.85em; font-weight:bold; margin-top:10px; display:none; text-align:center;">
            ğŸš¨ 3/24 ê¸°í•œ ë„ê³¼! ëª¨ë“  ì„ ë‚© í˜œíƒì´ ì†Œë©¸ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <div class="total-benefit-bar">
        ì´ ì„ ë‚©í• ì¸ í˜œíƒ: <span id="total-benefit" style="color:#4db6ac;">0</span>ì›
    </div>
</div>

<script>
    const RATE = 0.07;
    const END_D = new Date('2026-05-04');
    const LIMIT_D = new Date('2026-03-24');

    function updateFormat(el) {
        let val = el.value.replace(/[^0-9]/g, '');
        el.value = val ? Number(val).toLocaleString() : '';
        calculate();
    }

    function addRow() {
        const tbody = document.getElementById('row-body');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="date" class="i-date" oninput="calculate()"></td>
            <td><input type="text" class="i-amt" oninput="updateFormat(this)" placeholder="0"></td>
            <td class="r-days">-</td>
            <td class="r-int txt-red">0</td>
        `;
        tbody.appendChild(tr);
    }

    function calculate() {
        let baseTotal = parseInt(document.getElementById('base-total').value.replace(/,/g, '')) || 0;
        let currentBal = baseTotal;
        const fDateVal = document.getElementById('final-date').value;
        const isExpired = fDateVal && new Date(fDateVal) > LIMIT_D;
        
        document.getElementById('main-cont').className = isExpired ? 'container expired' : 'container';
        document.getElementById('warn-msg').style.display = isExpired ? 'block' : 'none';

        const rows = document.querySelectorAll('#row-body tr');
        let totalIntSum = 0;

        rows.forEach(row => {
            const dVal = row.querySelector('.i-date').value;
            const aVal = parseInt(row.querySelector('.i-amt').value.replace(/,/g, '')) || 0;
            const dayCell = row.querySelector('.r-days');
            const intCell = row.querySelector('.r-int');

            let interest = 0;
            if (dVal && !isExpired && aVal >= 10000000) {
                const pDate = new Date(dVal);
                let days = Math.floor((END_D - pDate) / (1000 * 60 * 60 * 24)) + 1;
                days = Math.max(0, Math.min(100, days));
                dayCell.innerText = days;
                interest = Math.floor((aVal * RATE * days / 365) / 10) * 10;
            } else {
                dayCell.innerText = dVal && isExpired ? "ì†Œë©¸" : "-";
                interest = 0;
            }
            intCell.innerText = interest.toLocaleString();
            currentBal -= (aVal + interest);
            totalIntSum += interest;
        });

        document.getElementById('res-bal').innerText = currentBal.toLocaleString() + "ì›";

        let finalInt = 0;
        if (fDateVal) {
            if (!isExpired && currentBal > 0) {
                const fDate = new Date(fDateVal);
                let fDays = Math.floor((END_D - fDate) / (1000 * 60 * 60 * 24)) + 1;
                fDays = Math.max(0, Math.min(100, fDays));
                finalInt = Math.floor((currentBal * RATE * fDays / 365) / 10) * 10;
            }
            if (!isExpired) totalIntSum += finalInt;
        }
        
        document.getElementById('f-int').innerText = finalInt.toLocaleString();
        let finalBookBal = currentBal - finalInt; // ì‹¤ì œ ì¥ë¶€ìƒ ì”ì•¡
        
        const fBookBalEl = document.getElementById('total-book-bal');
        fBookBalEl.innerText = finalBookBal.toLocaleString() + "ì›";
        fBookBalEl.style.color = finalBookBal < 0 ? "#1565c0" : "#333";

        const fPayEl = document.getElementById('final-pay');
        const refundMsg = document.getElementById('refund-msg');
        
        if (finalBookBal < 0 && !isExpired) {
            fPayEl.innerText = "0ì›";
            refundMsg.style.display = 'block';
            document.getElementById('refund-amt').innerText = Math.abs(finalBookBal).toLocaleString();
        } else {
            fPayEl.innerText = Math.max(0, finalBookBal).toLocaleString() + "ì›";
            refundMsg.style.display = 'none';
        }
        
        document.getElementById('total-benefit').innerText = isExpired ? "0" : totalIntSum.toLocaleString();
    }
    window.onload = addRow;
</script>
</body>
</html>
